version: 2
jobs:
  linux64:
    docker:
      - image: minextu/sdl2-cross-platform
    steps:
      - run: apt-get update && apt-get install -y zip
      - run: git clone https://github.com/kometbomb/klystron.git
      - run: git clone https://github.com/kometbomb/klystrack.git && cd klystrack && git checkout $CIRCLE_BRANCH
      - run: cd klystrack && make CC=gcc CFG=release RES_PATH=.
      - run: cd klystrack && zip -j /tmp/klystrack.zip bin.release/klystrack doc/Default.kt && zip -r /tmp/klystrack.zip res key examples LICENSE doc/SDL.txt doc/SDL_image.txt
      - store_artifacts:
          path: /tmp/klystrack-linux64.zip
  win32:
    docker:
      - image: minextu/sdl2-cross-platform
    steps:
      - run: apt-get update && apt-get install -y zip
      - run: git clone https://github.com/kometbomb/klystron.git
      - run: git clone https://github.com/kometbomb/klystrack.git && cd klystrack && git checkout $CIRCLE_BRANCH
      - run: COMSPEC=1 && cd klystrack && make CC=CC=x86_64-w32-mingw32-gcc CFG=release RES_PATH=.
      - run: cd klystrack && zip -j /tmp/klystrack.zip bin.release/klystrack doc/Default.kt && zip -r /tmp/klystrack.zip res key examples LICENSE doc/SDL.txt doc/SDL_image.txt
      - store_artifacts:
          path: /tmp/klystrack-win32.zip
  win64:
    docker:
      - image: minextu/sdl2-cross-platform
    steps:
      - run: apt-get update && apt-get install -y zip
      - run: git clone https://github.com/kometbomb/klystron.git
      - run: git clone https://github.com/kometbomb/klystrack.git && cd klystrack && git checkout $CIRCLE_BRANCH
      - run: COMSPEC=1 && cd klystrack && make CC=CC=x86_64-w64-mingw32-gcc CFG=release RES_PATH=.
      - run: cd klystrack && zip -j /tmp/klystrack.zip bin.release/klystrack doc/Default.kt && zip -r /tmp/klystrack.zip res key examples LICENSE doc/SDL.txt doc/SDL_image.txt
      - store_artifacts:
          path: /tmp/klystrack-win64.zip
